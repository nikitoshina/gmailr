<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content='
This pair of functions writes an OAuth2 user token to file and reads it back
in. This is rarely necessary when working in your primary, interactive
computing environment. In that setting, it is recommended to lean into the
automatic token caching built-in to gmailr / gargle. However, when preparing
a user token for use elsewhere, such as in CI or in a deployed data product,
it can be useful to take the full control granted by gm_token_write() and
gm_token_read().
Below is an outline of the intended workflow, but you will need to fill in
particulars, such as filepaths and environment variables:
Do auth in your primary, interactive environment as the target user, with
the desired OAuth client and scopes.
gm_auth_configure()
gm_auth("jane@example.com", cache = FALSE)

Confirm you are logged in as the intended user:
gm_profile()

Write the current token to file:
gm_token_write(
  path = "path/to/gmailr-token.rds",
  key = "GMAILR_KEY"
)

In the deployed, non-interactive setting, read the token from file and
tell gmailr to use it:
gm_auth(token = gm_token_read(
  path = "path/to/gmailr-token.rds",
  key = "GMAILR_KEY"
)


'><title>Write/read a gmailr user token — gm_token_write • gmailr</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_Pro-0.4.6/font.css" rel="stylesheet"><link href="../deps/Source_Code_Pro-0.4.6/font.css" rel="stylesheet"><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Write/read a gmailr user token — gm_token_write"><meta property="og:description" content='
This pair of functions writes an OAuth2 user token to file and reads it back
in. This is rarely necessary when working in your primary, interactive
computing environment. In that setting, it is recommended to lean into the
automatic token caching built-in to gmailr / gargle. However, when preparing
a user token for use elsewhere, such as in CI or in a deployed data product,
it can be useful to take the full control granted by gm_token_write() and
gm_token_read().
Below is an outline of the intended workflow, but you will need to fill in
particulars, such as filepaths and environment variables:
Do auth in your primary, interactive environment as the target user, with
the desired OAuth client and scopes.
gm_auth_configure()
gm_auth("jane@example.com", cache = FALSE)

Confirm you are logged in as the intended user:
gm_profile()

Write the current token to file:
gm_token_write(
  path = "path/to/gmailr-token.rds",
  key = "GMAILR_KEY"
)

In the deployed, non-interactive setting, read the token from file and
tell gmailr to use it:
gm_auth(token = gm_token_read(
  path = "path/to/gmailr-token.rds",
  key = "GMAILR_KEY"
)


'><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><script defer data-domain="gmailr.r-lib.org,all.tidyverse.org" src="https://plausible.io/js/plausible.js"></script></head><body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-none"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">gmailr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">2.0.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../articles/gmailr.html">Get started</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/oauth-client.html">Set up an OAuth client</a>
    <a class="dropdown-item" href="../articles/deploy-a-token.html">Deploy a token</a>
    <a class="dropdown-item" href="../articles/sending_messages.html">Sending Messages With Gmailr</a>
  </div>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-news">News</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-news">
    <h6 class="dropdown-header" data-toc-skip>Releases</h6>
    <a class="external-link dropdown-item" href="https://www.tidyverse.org/blog/2023/06/gmailr-1-0-0/">gmailr 2.0.0</a>
    <a class="external-link dropdown-item" href="https://www.tidyverse.org/articles/2019/08/gmailr-1-0-0/">gmailr 1.0.0</a>
    <div class="dropdown-divider"></div>
    <a class="dropdown-item" href="../news/index.html">Changelog</a>
  </div>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/r-lib/gmailr/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic" id="container">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Write/read a gmailr user token</h1>
      <small class="dont-index">Source: <a href="https://github.com/r-lib/gmailr/blob/HEAD/R/gm_auth.R" class="external-link"><code>R/gm_auth.R</code></a></small>
      <div class="d-none name"><code>gm_token_write.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental" class="external-link"><img src="figures/lifecycle-experimental.svg" alt="[Experimental]"></a></p>
<p>This pair of functions writes an OAuth2 user token to file and reads it back
in. This is rarely necessary when working in your primary, interactive
computing environment. In that setting, it is recommended to lean into the
automatic token caching built-in to gmailr / gargle. However, when preparing
a user token for use elsewhere, such as in CI or in a deployed data product,
it can be useful to take the full control granted by <code>gm_token_write()</code> and
<code>gm_token_read()</code>.</p>
<p>Below is an outline of the intended workflow, but you will need to fill in
particulars, such as filepaths and environment variables:</p><ul><li><p>Do auth in your primary, interactive environment as the target user, with
the desired OAuth client and scopes.</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="fu"><a href="../reference/gm_auth_configure.html">gm_auth_configure</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/gm_auth.html">gm_auth</a></span><span class="op">(</span><span class="st">"jane@example.com"</span>, cache <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre><p></p></div></li>
<li><p>Confirm you are logged in as the intended user:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="fu"><a href="../reference/gm_profile.html">gm_profile</a></span><span class="op">(</span><span class="op">)</span></span></code></pre><p></p></div></li>
<li><p>Write the current token to file:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="fu"><a href="../reference/gm_token_write.html">gm_token_write</a></span><span class="op">(</span></span>
<span>  path <span class="op">=</span> <span class="st">"path/to/gmailr-token.rds"</span>,</span>
<span>  key <span class="op">=</span> <span class="st">"GMAILR_KEY"</span></span>
<span><span class="op">)</span></span></code></pre><p></p></div></li>
<li><p>In the deployed, non-interactive setting, read the token from file and
tell gmailr to use it:</p>
<p></p><div class="sourceCode r"><pre><code>gm_auth(token = gm_token_read(
  path = "path/to/gmailr-token.rds",
  key = "GMAILR_KEY"
)
</code></pre><p></p></div></li>
</ul></div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">gm_token_write</span><span class="op">(</span>token <span class="op">=</span> <span class="fu"><a href="gm_token.html">gm_token</a></span><span class="op">(</span><span class="op">)</span>, path <span class="op">=</span> <span class="st">"gmailr-token.rds"</span>, key <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">gm_token_read</span><span class="op">(</span>path <span class="op">=</span> <span class="st">"gmailr-token.rds"</span>, key <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>token</dt>
<dd><p>A token with class <a href="https://httr.r-lib.org/reference/Token-class.html" class="external-link">Token2.0</a> or an object of
httr's class <code>request</code>, i.e. a token that has been prepared with
<code><a href="https://httr.r-lib.org/reference/config.html" class="external-link">httr::config()</a></code> and has a <a href="https://httr.r-lib.org/reference/Token-class.html" class="external-link">Token2.0</a> in the
<code>auth_token</code> component.</p></dd>


<dt>path</dt>
<dd><p>The path to write to (<code>gm_token_write()</code>) or to read from
(<code>gm_token_read()</code>).</p></dd>


<dt>key</dt>
<dd><p>Encryption key, as implemented by httr2's <a href="https://httr2.r-lib.org/reference/secrets.html" class="external-link">secret functions</a>. If absent, a
built-in <code>key</code> is used. If supplied, the <code>key</code> should usually be the name
of an environment variable whose value was generated with
<code><a href="https://gargle.r-lib.org/reference/gargle_secret.html" class="external-link">gargle::secret_make_key()</a></code> (which is a copy of
<code>httr2::secret_make_key()</code>). The <code>key</code> argument of <code>gm_token_read()</code> must
match the <code>key</code> used in <code>gm_token_write()</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="security">Security<a class="anchor" aria-label="anchor" href="#security"></a></h2>
    

<p><code>gm_token_write()</code> and <code>gm_token_read()</code> have a more security-oriented
implementation than the default token caching strategy. OAuth2 user tokens
are somewhat opaque by definition, because they aren't written to file in a
particularly transparent format. However, <code>gm_token_write()</code> always applies
some additional obfuscation to make such credentials even more resilient
against scraping by an automated tool. However, a knowledgeable R programmer
could decode the credential with some effort. The default behaviour of
<code>gm_token_write()</code> (called without <code>key</code>) is suitable for tokens stored in a
relatively secure place, such as on Posit Connect within your organization.</p>
<p>To prepare a stored credential for exposure in a more public setting, such as
on GitHub or CRAN, you must actually encrypt it, using a <code>key</code> known only to
you. You must make the encryption <code>key</code> available via a secure environment
variable in any setting where you wish to decrypt and use the token, such as
on GitHub Actions.</p>
    </div>

  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p></p><p>Developed by <a href="https://www.jimhester.com/" class="external-link">Jim Hester</a>, <a href="https://jennybryan.org" class="external-link">Jennifer Bryan</a>, <a href="https://www.posit.co" class="external-link"><img src="https://www.tidyverse.org/posit-logo.svg" alt="Posit" height="16" style="margin-bottom: 3px;"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

  </div></footer></body></html>

