<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Authorize gmailr to view and manage your Gmail projects. This function is a
wrapper around gargle::token_fetch().
By default, you are directed to a web browser, asked to sign in to your
Google account, and to grant gmailr permission to operate on your
behalf with Google Gmail. By default, with your permission, these user
credentials are cached in a folder below your home directory, from where
they can be automatically refreshed, as necessary. Storage at the user
level means the same token can be used across multiple projects and
tokens are less likely to be synced to the cloud by accident."><title>Authorize gmailr — gm_auth • gmailr</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_Pro-0.4.6/font.css" rel="stylesheet"><link href="../deps/Source_Code_Pro-0.4.6/font.css" rel="stylesheet"><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Authorize gmailr — gm_auth"><meta property="og:description" content="Authorize gmailr to view and manage your Gmail projects. This function is a
wrapper around gargle::token_fetch().
By default, you are directed to a web browser, asked to sign in to your
Google account, and to grant gmailr permission to operate on your
behalf with Google Gmail. By default, with your permission, these user
credentials are cached in a folder below your home directory, from where
they can be automatically refreshed, as necessary. Storage at the user
level means the same token can be used across multiple projects and
tokens are less likely to be synced to the cloud by accident."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><script defer data-domain="gmailr.r-lib.org,all.tidyverse.org" src="https://plausible.io/js/plausible.js"></script></head><body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-none"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">gmailr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">2.0.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../articles/gmailr.html">Get started</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/oauth-client.html">Set up an OAuth client</a>
    <a class="dropdown-item" href="../articles/deploy-a-token.html">Deploy a token</a>
    <a class="dropdown-item" href="../articles/sending_messages.html">Sending Messages With Gmailr</a>
  </div>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-news">News</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-news">
    <h6 class="dropdown-header" data-toc-skip>Releases</h6>
    <a class="external-link dropdown-item" href="https://www.tidyverse.org/articles/2019/08/gmailr-1-0-0/">gmailr 1.0.0</a>
    <div class="dropdown-divider"></div>
    <a class="dropdown-item" href="../news/index.html">Changelog</a>
  </div>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/r-lib/gmailr/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic" id="container">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Authorize gmailr</h1>
      <small class="dont-index">Source: <a href="https://github.com/r-lib/gmailr/blob/HEAD/R/gm_auth.R" class="external-link"><code>R/gm_auth.R</code></a></small>
      <div class="d-none name"><code>gm_auth.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Authorize gmailr to view and manage your Gmail projects. This function is a
wrapper around <code><a href="https://gargle.r-lib.org/reference/token_fetch.html" class="external-link">gargle::token_fetch()</a></code>.</p>
<p>By default, you are directed to a web browser, asked to sign in to your
Google account, and to grant gmailr permission to operate on your
behalf with Google Gmail. By default, with your permission, these user
credentials are cached in a folder below your home directory, from where
they can be automatically refreshed, as necessary. Storage at the user
level means the same token can be used across multiple projects and
tokens are less likely to be synced to the cloud by accident.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">gm_auth</span><span class="op">(</span></span>
<span>  email <span class="op">=</span> <span class="fu"><a href="gmailr-configuration.html">gm_default_email</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  path <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  subject <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  scopes <span class="op">=</span> <span class="st">"full"</span>,</span>
<span>  cache <span class="op">=</span> <span class="fu">gargle</span><span class="fu">::</span><span class="fu"><a href="https://gargle.r-lib.org/reference/gargle_options.html" class="external-link">gargle_oauth_cache</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  use_oob <span class="op">=</span> <span class="fu">gargle</span><span class="fu">::</span><span class="fu"><a href="https://gargle.r-lib.org/reference/gargle_options.html" class="external-link">gargle_oob_default</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  token <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>email</dt>
<dd><p>Optional. If specified, <code>email</code> can take several different
forms:</p><ul><li><p><code>"jane@gmail.com"</code>, i.e. an actual email address. This allows the user to
target a specific Google identity. If specified, this is used for token
lookup, i.e. to determine if a suitable token is already available in the
cache. If no such token is found, <code>email</code> is used to pre-select the targeted
Google identity in the OAuth chooser. (Note, however, that the email
associated with a token when it's cached is always determined from the token
itself, never from this argument).</p></li>
<li><p><code>"*@example.com"</code>, i.e. a domain-only glob pattern. This can be helpful if
you need code that "just works" for both <code>alice@example.com</code> and
<code>bob@example.com</code>.</p></li>
<li><p><code>TRUE</code> means that you are approving email auto-discovery. If exactly one
matching token is found in the cache, it will be used.</p></li>
<li><p><code>FALSE</code> or <code>NA</code> mean that you want to ignore the token cache and force a
new OAuth dance in the browser.</p></li>
</ul><p>Defaults to the option named <code>"gargle_oauth_email"</code>, retrieved by
<code><a href="https://gargle.r-lib.org/reference/gargle_options.html" class="external-link">gargle_oauth_email()</a></code> (unless a wrapper package implements different
default behavior).</p></dd>


<dt>path</dt>
<dd><p>JSON identifying the service account, in one of the forms
supported for the <code>txt</code> argument of <code><a href="https://rdrr.io/pkg/jsonlite/man/fromJSON.html" class="external-link">jsonlite::fromJSON()</a></code> (typically, a
file path or JSON string).</p></dd>


<dt>subject</dt>
<dd><p>An optional subject claim. Specify this if you wish to use the
service account represented by <code>path</code> to impersonate the <code>subject</code>, who is
a normal user. Before this can work, an administrator must grant the service
account domain-wide authority. Identify the user to impersonate via their
email, e.g. <code>subject = "user@example.com"</code>. Note that gargle automatically
adds the non-sensitive <code>"https://www.googleapis.com/auth/userinfo.email"</code>
scope, so this scope must be enabled for the service account, along with
any other <code>scopes</code> being requested.</p></dd>


<dt>scopes</dt>
<dd><p>One or more API scopes. Each scope can be specified in full or,
for Gmail API-specific scopes, in an abbreviated form that is recognized by
<code><a href="gm_scopes.html">gm_scopes()</a></code>:</p><ul><li><p>"full" = "https://mail.google.com/" (the default)</p></li>
<li><p>"gmail.compose" = "https://www.googleapis.com/auth/gmail.compose"</p></li>
<li><p>"gmail.readonly" = "https://www.googleapis.com/auth/gmail.readonly"</p></li>
<li><p>"gmail.labels" = "https://www.googleapis.com/auth/gmail.labels"</p></li>
<li><p>"gmail.send" = "https://www.googleapis.com/auth/gmail.send"</p></li>
<li><p>"gmail.insert" = "https://www.googleapis.com/auth/gmail.insert"</p></li>
<li><p>"gmail.modify" = "https://www.googleapis.com/auth/gmail.modify"</p></li>
<li><p>"gmail.metadata" = "https://www.googleapis.com/auth/gmail.metadata"</p></li>
<li><p>"gmail.settings_basic" = "https://www.googleapis.com/auth/gmail.settings.basic"</p></li>
<li><p>"gmail.settings_sharing" = "https://www.googleapis.com/auth/gmail.settings.sharing"</p></li>
</ul><p>See <a href="https://developers.google.com/gmail/api/auth/scopes" class="external-link">https://developers.google.com/gmail/api/auth/scopes</a> for details on the
permissions for each scope.</p></dd>


<dt>cache</dt>
<dd><p>Specifies the OAuth token cache. Defaults to the option named
<code>"gargle_oauth_cache"</code>, retrieved via <code><a href="https://gargle.r-lib.org/reference/gargle_options.html" class="external-link">gargle_oauth_cache()</a></code>.</p></dd>


<dt>use_oob</dt>
<dd><p>Whether to use out-of-band authentication (or, perhaps, a
variant implemented by gargle and known as "pseudo-OOB") when first
acquiring the token. Defaults to the value returned by
<code><a href="https://gargle.r-lib.org/reference/gargle_options.html" class="external-link">gargle_oob_default()</a></code>. Note that (pseudo-)OOB auth only affects
the initial OAuth dance. If we retrieve (and possibly refresh) a
cached token, <code>use_oob</code> has no effect.</p>
<p>If the OAuth client is provided implicitly by a wrapper package, its type
probably defaults to the value returned by
<code><a href="https://gargle.r-lib.org/reference/gargle_options.html" class="external-link">gargle_oauth_client_type()</a></code>. You can take control of the client
type by setting <code>options(gargle_oauth_client_type = "web")</code> or
<code>options(gargle_oauth_client_type = "installed")</code>.</p></dd>


<dt>token</dt>
<dd><p>A token with class <a href="https://httr.r-lib.org/reference/Token-class.html" class="external-link">Token2.0</a> or an object of
httr's class <code>request</code>, i.e. a token that has been prepared with
<code><a href="https://httr.r-lib.org/reference/config.html" class="external-link">httr::config()</a></code> and has a <a href="https://httr.r-lib.org/reference/Token-class.html" class="external-link">Token2.0</a> in the
<code>auth_token</code> component.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Most users, most of the time, do not need to call <code>gm_auth()</code>
explicitly -- it is triggered by the first action that requires
authorization. Even when called, the default arguments often suffice.</p>
<p>However, when necessary, <code>gm_auth()</code> allows the user to explicitly:</p><ul><li><p>Declare which Google identity to use, via an <code>email</code> specification.</p></li>
<li><p>Use a service account token or workload identity federation via
<code>path</code>.</p></li>
<li><p>Bring your own <code>token</code>.</p></li>
<li><p>Customize <code>scopes</code>.</p></li>
<li><p>Use a non-default <code>cache</code> folder or turn caching off.</p></li>
<li><p>Explicitly request out-of-bound (OOB) auth via <code>use_oob</code>.</p></li>
</ul><p>If you are interacting with R within a browser (applies to RStudio
Server, Posit Workbench, Posit Cloud, and Google Colaboratory), you need
OOB auth or the pseudo-OOB variant. If this does not happen
automatically, you can request it explicitly with <code>use_oob = TRUE</code> or,
more persistently, by setting an option via
<code>options(gargle_oob_default = TRUE)</code>.</p>
<p>The choice between conventional OOB or pseudo-OOB auth is determined
by the type of OAuth client. If the client is of the "installed" type,
<code>use_oob = TRUE</code> results in conventional OOB auth. If the client is of
the "web" type, <code>use_oob = TRUE</code> results in pseudo-OOB auth. Packages
that provide a built-in OAuth client can usually detect which type of
client to use. But if you need to set this explicitly, use the
<code>"gargle_oauth_client_type"</code> option:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>gargle_oauth_client_type <span class="op">=</span> <span class="st">"web"</span><span class="op">)</span>       <span class="co"># pseudo-OOB</span></span>
<span><span class="co"># or, alternatively</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>gargle_oauth_client_type <span class="op">=</span> <span class="st">"installed"</span><span class="op">)</span> <span class="co"># conventional OOB</span></span></code></pre><p></p></div>
<p>For details on the many ways to find a token, see
<code><a href="https://gargle.r-lib.org/reference/token_fetch.html" class="external-link">gargle::token_fetch()</a></code>. For deeper control over auth, use
<code><a href="gm_auth_configure.html">gm_auth_configure()</a></code> to bring your own OAuth client or API key.
To learn more about gargle options, see <a href="https://gargle.r-lib.org/reference/gargle_options.html" class="external-link">gargle::gargle_options</a>.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>Other auth functions: 
<code><a href="gm_auth_configure.html">gm_auth_configure</a>()</code>,
<code><a href="gm_deauth.html">gm_deauth</a>()</code>,
<code><a href="gm_scopes.html">gm_scopes</a>()</code>,
<code><a href="gmailr-configuration.html">gmailr-configuration</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># rlang::is_interactive()</span></span></span>
<span class="r-in"><span><span class="co"># load/refresh existing credentials, if available</span></span></span>
<span class="r-in"><span><span class="co"># otherwise, go to browser for authentication and authorization</span></span></span>
<span class="r-in"><span><span class="fu">gm_auth</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># indicate the specific identity you want to auth as</span></span></span>
<span class="r-in"><span><span class="fu">gm_auth</span><span class="op">(</span>email <span class="op">=</span> <span class="st">"jenny@example.com"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># force a new browser dance, i.e. don't even try to use existing user</span></span></span>
<span class="r-in"><span><span class="co"># credentials</span></span></span>
<span class="r-in"><span><span class="fu">gm_auth</span><span class="op">(</span>email <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># specify the identity, use a 'read only' scope, so it's impossible to</span></span></span>
<span class="r-in"><span><span class="co"># send or delete email, and specify a cache folder</span></span></span>
<span class="r-in"><span><span class="fu">gm_auth</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="st">"target.user@example.com"</span>,</span></span>
<span class="r-in"><span>  scopes <span class="op">=</span> <span class="st">"gmail.readonly"</span>,</span></span>
<span class="r-in"><span>  cache <span class="op">=</span> <span class="st">"some/nice/directory/"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p></p><p>Developed by <a href="https://www.jimhester.com/" class="external-link">Jim Hester</a>, <a href="https://jennybryan.org" class="external-link">Jennifer Bryan</a>, <a href="https://www.posit.co" class="external-link"><img src="https://www.tidyverse.org/posit-logo.svg" alt="Posit" height="16" style="margin-bottom: 3px;"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

  </div></footer></body></html>

